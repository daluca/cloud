---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: prometheus
  namespace: monitoring
spec:
  chart:
    spec:
      version: ">=44.0.0 <45.0.0"
  test:
    enable: false
  values:
    alertmanager:
      ingress:
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt-cloudflare
        hosts:
          - alertmanager.${TERTIARY_DOMAIN}
        tls:
          - secretName: alertmanager-stg-tls
            hosts:
              - alertmanager.${TERTIARY_DOMAIN}
      alertmanagerSpec:
        replicas: 1
    grafana:
      replicas: 1
      ingress:
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt-cloudflare
        hosts:
          - grafana.${TERTIARY_DOMAIN}
        tls:
          - secretName: grafana-stg-tls
            hosts:
              - grafana.${TERTIARY_DOMAIN}
    prometheus:
      ingress:
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt-cloudflare
        hosts:
          - prometheus.${TERTIARY_DOMAIN}
        tls:
          - secretName: prometheus-stg-tls
            hosts:
              - prometheus.${TERTIARY_DOMAIN}
      prometheusSpec:
        replicas: 1
        retention: 8d
        retentionSize: 2GiB
